@model IEnumerable<OnlineLibrary.Areas.Admin.Models.ReturnBookModel>

<div class="col-sm-9 text-left">

  <div class="modal fade" id="alertModal" role="dialog" style="z-index:99999">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Return a book</h4>
        </div>
        <div class="modal-body">
          <div id="alertMsg">Are you sure you want to return this book?</div>
        </div>
        <div class="modal-footer">
          @using (@Html.BeginForm("Return", "ReturnLoans", FormMethod.Post, new { id = "ReturnBook_form" }))
          {
            <input type="hidden" name="LoanedBook" id="LoanedBook" value="" />
            <input type="submit" class="btn btn-default" value="Ok" id="ReturnBook">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          }
        </div>
      </div>
    </div>
  </div>

  <h1 class="title">Return a Book</h1>
  <p>
    Loaned books
  </p>
  <table class="table">
    <tr>
      <th>
        @Html.DisplayNameFor(model => model.UserName)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Title)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Author)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.LoanDate)
      </th>
      <th></th>
    </tr>

    @foreach (var item in Model)
    {
      <tr id="@item.ID">
        <td>
          @Html.DisplayFor(modelItem => item.UserName)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Title)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Author)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.LoanDate)
        </td>
        <td>
          @Html.ActionLink("Edit", "Edit", new { id = item.ID }) |
          @Html.ActionLink("Return", "", "", null, new { @class="modalReturn", data_toggle = "modal", data_target = "#alertModal", data_id= item.ID, id = item.ID })
        </td>
      </tr>
    }

  </table>
</div>
<script>
  window.onload = function () {
    $(document).ready(function () {
      $(".modalReturn").click(function () {
        $("#LoanedBook").val($(this).data('id'));
        var authorCapitalized = $.trim($("#" + $(this).data('id')).find('td:eq(2)').text());
        var url = '@Url.Action("PopulateDropDown", "Authors")';
        var authors = $('#authorDropDownList');
        $.getJSON(url, function (response) {
          authors.empty();
          var isSelected = "";
          $.each(response, function (index, item) {
            console.log(authorCapitalized);
            isSelected = (item.Text == authorCapitalized) ? "selected" : "";
            authors.append($('<option ' + isSelected + '></option>').text(item.Text).val(item.AuthorID));

          });
        });
      });
    });
  }
</script>